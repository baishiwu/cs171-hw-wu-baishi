<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
  <body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <style>
      
      table {
        border-spacing: 0px;
      }
      
      td, th, caption {
        padding: 1px 4px;
        border: 1px solid #9e9e9e;
      }

      /* Added zebra pattern */
      tbody tr:nth-child(2n) {
        background-color: #d3d3d3; 
      }

      tbody tr:hover {
        background-color: yellow;
      }

      tbody td:nth-child(1), td:nth-child(2)  {
        text-align: center;
      }
      
      tbody td {
        text-align: right;
      }
     

    </style>
    <script>

      d3.json("data/countries_2012.json", function(error, data){

        // Removing columns not displayed in the implementation
        data_truncated = data.map(function(d) {
          return {
            name: d.name,
            continent: d.continent,
            gdp: d.gdp,
            life_expectancy: d.life_expectancy,
            population: d.population,
            year: d.year
          };
        });

        var columns = Object.keys(data_truncated[0]);

        var prefix = d3.formatPrefix(1e9);
        
        var sortAsc = false;

        var table = d3.select("body").append("table"),
          thead = table.append("thead")
                       .attr("class", "thead");
          tbody = table.append("tbody");

        table.append("caption")
          .html("World Countries Ranking");

        thead.append("tr").selectAll("th")
          .data(columns)
        .enter()
          .append("th")
          .text(function(d) {
            return d; 
          })
          .on("click", function(header, i) {
            if (sortAsc) {
              sortAsc = !sortAsc;
              tbody.selectAll("tr").sort(function(a, b) {
                return d3.descending(a[header], b[header]) || d3.ascending(a['name'], b['name']);
              });
            } else {
              sortAsc = !sortAsc;
              tbody.selectAll("tr").sort(function(a, b) {
                return d3.ascending(a[header], b[header]) || d3.ascending(a['name'], b['name']);
              });
            };
          });

        var rows = tbody.selectAll("tr.row")
          .data(data_truncated)
          .enter()
          .append("tr").attr("class", "row")

        var cells = rows.selectAll("td")
          .data(function(row) {
              return d3.range(Object.keys(row).length).map(function(column, i) {
                  row.life_expectancy = d3.format(".1f")(row.life_expectancy);
                  return row[Object.keys(row)[i]];
              });
          })
          .enter()
          .append("td")
          .text(function(d, i) {
            if (i === 2) { 
              d = d3.format(".1f")(prefix.scale(d)) + prefix.symbol;
            } else if (i === 4) {
              d = d3.format(",.0f")(d);
            }
            return d;
          })
      });
    </script> 
  </body>
</html>